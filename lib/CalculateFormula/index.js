!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["CalculateFormula/index"]=t():e["CalculateFormula/index"]=t()}(this,(()=>(()=>{"use strict";var e={d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>r});class r{constructor(e){this.allowedChar=!1,this.charMap={},this.autoChange=!1,this.infix=e.infix,e.allowedChar&&(this.allowedChar=e.allowedChar),e.charMap&&(this.charMap=e.charMap),e.autoChange&&(this.autoChange=e.autoChange);const t=this._infixCalculate(this.infix);this.isLegal=t.isLegal,this.result=t.result,this.isLegal&&(this.formula=e.infix.join(""),this.minRes=this._calculateMin(this.infix),this.maxRes=this._calculateMax(this.infix))}_infixCalculate(e,t=this.allowedChar){let r={isLegal:!1,result:0};if(t){r.result=void 0;let t=[],i=0,a=0;for(let s=0;s<e.length;s++)if("("===e[s])t.push(e[s]);else if(")"===e[s]){let i=t.pop();if(0===s)return r;if("("!==i||"("===e[s-1])return r}else if(this._isOperator(e[s])){if(s+1===e.length||0===s)return r;if(this._isOperator(e[s+1])||this._isOperator(e[s-1]))return r;i++}else a++;if(0!==t.length)return r;if(i+1!==a)return r}else{let t=[],i=[],a=!1;for(let s=0;s<e.length;s++){if(void 0===e[s]||null===e[s])return r;if("("===e[s]||this._isOperator(e[s]))t.push(e[s]);else if(this._isOperand(e[s])&&i.push(e[s]),")"===e[s]||s+1===e.length&&0!==t.length){let l=t[t.length-1];if(a&&")"===e[s])return r;for(;"("!==l;){let e=t.length-1,a=i.length-1;for(;0!==t.length&&this._ge(t[e-1],t[e]);)e--,a--;let s=i[a],n=i[a-1];if(l=t[e],void 0===n||void 0===s)return r;if(("/"===l||"÷"===l)&&0===s)return r;if("string"!=typeof n&&"string"!=typeof s||console.warn("you should set autoChange to true"),i.splice(a-1,2,this._cal(Number(n),l,Number(s))),t.splice(e,1),0===t.length)break;l=t[t.length-1]}t.pop()}a=this._isOpOrBracket(e[s])}if(t.length+1!==i.length)return r;r.result=i.pop()}return r.isLegal=!0,r}_calculateMin(e,t="min",r=this.autoChange){let i=e.concat();for(let e=0;e<i.length;e++){let a=this.charMap[i[e]];if(r&&!Number.isNaN(Number(i[e])))i[e]=Number(i[e]);else if(!this._isOpOrBracket(i[e])&&"number"!=typeof i[e]){if(void 0===a)return void console.log(`charMap ${i[e]} is undefined`);if(Number.isNaN(Number(a[t])))return void console.error(`${i[e]}.${t} is NaN`);i[e]=Number(a[t])}}return this._infixCalculate(i,!1).result}_calculateMax(e,t="max",r=this.autoChange){let i=e.concat();for(let e=0;e<i.length;e++){let a=this.charMap[i[e]];if(r&&!Number.isNaN(Number(i[e])))i[e]=Number(i[e]);else if(!this._isOpOrBracket(i[e])&&"number"!=typeof i[e]){if(void 0===a)return void console.log(`charMap ${i[e]} is undefined`);if(Number.isNaN(Number(a[t])))return void console.error(`${i[e]}.${t} is NaN`);i[e]=Number(a[t])}}return this._infixCalculate(i,!1).result}_cal(e,t,r){switch(t){case"+":return e+r;case"-":return e-r;case"*":case"×":return e*r;case"/":case"÷":return e/r}}_replace(e){switch(e){case"(":return 0;case"+":return 1;case"-":return 2;case"*":case"×":return 3;case"/":case"÷":return 4}}_isOperator(e){return/^[\+\-\*\/÷×]$/.test(String(e))}_isOpOrBracket(e){return/^[\+\-\*\/\(\)×÷]$/.test(String(e))}_isOperand(e){return!Number.isNaN(Number(e))}_ge(e,t){return this._replace(t)<=this._replace(e)}}return t})()));